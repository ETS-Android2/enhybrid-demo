#!/usr/bin/env node

module.exports = function(ctx) {
  var shell = require('shelljs');
  var path = require('path');
  var fs = require('fs-extra');
  var ConfigParser = ctx.requireCordovaModule('cordova-common').ConfigParser,  
      config = new ConfigParser(path.join(ctx.opts.projectRoot, "config.xml")), 
      packageName = config.android_packageName() || config.packageName();

  try {
    var sourceFilesToEditor = path.join(ctx.opts.projectRoot, '/plugins/mobile-plugin-fingerprint/src/android/com/envisioncn/cordova/fingerprint');
    var files = shell.find(sourceFilesToEditor)
    for (var i = 0; i < files.length; i++) {
      var file = files[i];
      if(file.indexOf(".java") != -1) {
        writeSourceFileSync(fs, file, packageName);
      }
    }
  } catch (err) {
  }
}

function writeSourceFileSync(fs, file, packageName){
  var data = fs.readFileSync(file, {encoding: 'utf-8'}); 
  data = data.replace(/\${PACKAGE_NAME}/m, packageName);  
  fs.writeFileSync(file, data);
}
